<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hand Cricket</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background:#f3f7fb; padding:20px; text-align:center; }
    .section { margin:20px auto; max-width:900px; padding:15px; background:#fff; border-radius:8px; box-shadow:0 6px 20px rgba(0,0,0,0.06); }
    input, select, textarea, button { font-size:15px; padding:6px 10px; margin:6px; }
    .number-buttons button { width:60px; height:44px; margin:6px; font-size:16px; }
    #log, #ballLog, #bowlerStats { max-height:160px; overflow:auto; border:1px solid #ddd; background:#fafafa; padding:10px; text-align:left; font-family:monospace; }
    #resultBox { margin-top:16px; padding:12px; font-weight:bold; display:none; border-radius:6px; }
    #resultBox.win { background:#d1fae5; color:#065f46; }
    #resultBox.draw { background:#fef3c7; color:#92400e; }
    #resultBox.tie { background:#e0e7ff; color:#3730a3; }
  </style>
</head>
<body>

  <h1>Hand Cricket</h1>

  <div class="section" id="setup-section">
    <h2>Setup Match</h2>
    <input id="team1" placeholder="Your Team Name" />
    <input id="team2" placeholder="Computer Team Name" value="Computer" />
    <input id="overs" type="number" min="1" max="50" value="2" /> Overs

    <h3>Players (comma-separated)</h3>
    <textarea id="team1Players" rows="4" cols="40" placeholder="Your players (11 recommended)"></textarea><br>
    <textarea id="team2Players" rows="4" cols="40" placeholder="Computer players (11 recommended)"></textarea><br>

    <button onclick="startGame()">Start Game</button>

    <h3>Mode</h3>
    <select id="matchMode" onchange="setMode()">
      <option value="custom">Custom</option>
      <option value="t20i">T20I (4 overs)</option>
      <option value="odi">ODI (10 overs)</option>
      <option value="test">Test (12 overs/day, up to 5 days)</option>
      <option value="rct">RCT (15 overs)</option>
    </select>
  </div>

  <div class="section" id="game-section" style="display:none;">
    <h2 id="matchTitle"></h2>
    <h3 id="batsmenStatus"></h3>
    <p id="overInfo"></p>

    <label>Select Bowler:</label>
    <select id="bowlerSelect" onchange="setBowler()"></select>

    <div class="number-buttons">
      <button onclick="playBall(0)">0</button>
      <button onclick="playBall(1)">1</button>
      <button onclick="playBall(2)">2</button>
      <button onclick="playBall(3)">3</button>
      <button onclick="playBall(4)">4</button>
      <button onclick="playBall(5)">5</button>
      <button onclick="playBall(6)">6</button>
    </div>

    <div id="ballLog"></div>
    <div id="log"></div>
    <div id="bowlerStats"></div>
    <div id="resultBox"></div>
  </div>

<script>
/* ========= Game State ========= */
let teamNames = ["",""];
let overs = 2, ballsPerOver = 6, totalBallsPerInnings = 0;
let currentInnings = 0;
let striker = 0, nonStriker = 1;

let teamPlayers = [[], []];
let scores = [0,0,0,0];
let wickets = [0,0,0,0];
let ballsBowled = [0,0,0,0];
let batsmenStats = [[],[],[],[]];
let ballByBall = [[],[],[],[]];
let bowlerStats = [[], []];
let currentBowler = null;
let lastBowler = null;
let recentUserRuns = [];
let targets = [null,null,null,null];

/* Toss & control */
let userTeamIndex = 0;
let compTeamIndex = 1;
let userBattingFirst = true;
let tossWinner = null;

/* Test day tracking */
let dayNumber = 1;
let dayBallsCount = 0;            
const dayBallsLimit = 12 * ballsPerOver;

/* ========= Utilities ========= */
function getBattingTeamIndexForInnings(inn) {
  return (inn === 0 || inn === 2) ? (userBattingFirst ? userTeamIndex : compTeamIndex)
                                  : (userBattingFirst ? compTeamIndex : userTeamIndex);
}

function log(msg) {
  const l = document.getElementById('log');
  l.innerHTML += `<p>${msg}</p>`;
  l.scrollTop = l.scrollHeight;
}

/* ========= Toss ========= */
function doToss(){
  tossWinner = Math.random() < 0.5 ? userTeamIndex : compTeamIndex;
  const decision = tossWinner === userTeamIndex ? 
      (confirm(`${teamNames[userTeamIndex]} won toss! Bat first? OK=Bat, Cancel=Bowl`) ? "bat" : "bowl") :
      (Math.random() < 0.5 ? "bat" : "bowl");

  if(tossWinner === userTeamIndex){
    userBattingFirst = (decision === "bat");
    log(`${teamNames[userTeamIndex]} won toss and chose to ${decision} first.`);
  } else {
    userBattingFirst = (decision === "bowl");
    log(`${teamNames[compTeamIndex]} won toss and chose to ${decision} first.`);
  }
}

/* ========= Setup ========= */
function setMode(){
  const mode = document.getElementById('matchMode').value;
  const oversInput = document.getElementById('overs');
  if(mode === 't20i'){ oversInput.value = 4; oversInput.disabled = true; }
  else if(mode === 'odi'){ oversInput.value = 10; oversInput.disabled = true; }
  else if(mode === 'test'){ oversInput.value = 12; oversInput.disabled = true; }
  else if(mode === 'rct'){ oversInput.value = 15; oversInput.disabled = true; }
  else { oversInput.disabled = false; }
}

function startGame(){
  teamNames[0] = document.getElementById('team1').value || "User Team";
  teamNames[1] = document.getElementById('team2').value || "Computer";
  overs = parseInt(document.getElementById('overs').value);
  totalBallsPerInnings = overs * ballsPerOver;

  teamPlayers[0] = document.getElementById('team1Players').value.split(',').map(p=>p.trim()).filter(Boolean);
  teamPlayers[1] = document.getElementById('team2Players').value.split(',').map(p=>p.trim()).filter(Boolean);

  if(teamPlayers[0].length < 2 || teamPlayers[1].length < 2) {
    alert('Enter at least 2 players per team.');
    return;
  }

  for(let inn=0; inn<4; inn++){
    batsmenStats[inn] = [];
    for(let p=0; p<11; p++){
      batsmenStats[inn].push({ runs: 0, balls: 0 });
    }
    ballByBall[inn] = [];
    scores[inn] = 0; wickets[inn] = 0; ballsBowled[inn] = 0; targets[inn] = null;
  }

  for(let t=0; t<2; t++){
    bowlerStats[t] = [];
    for(let j=0;j<11;j++){
      bowlerStats[t].push({ name: teamPlayers[t][j] || `Bowler ${j+1}`, runs:0, balls:0, wickets:0 });
    }
  }

  doToss();

  currentInnings = 0; striker = 0; nonStriker = 1;
  currentBowler = null; lastBowler = null; recentUserRuns = [];
  dayNumber = 1; dayBallsCount = 0;

  document.getElementById('setup-section').style.display = 'none';
  document.getElementById('game-section').style.display = 'block';
  document.getElementById('resultBox').style.display = 'none';

  const firstBattingTeam = getBattingTeamIndexForInnings(0);
  log(`${teamNames[firstBattingTeam]} batting first!`);

  updateBowlerOptions();
  updateUI();
}

/* ========= UI ========= */
function updateUI(){
  const balls = ballsBowled[currentInnings];
  const oversCompleted = Math.floor(balls / ballsPerOver);
  const ballsInOver = balls % ballsPerOver;

  const battingTeamIndex = getBattingTeamIndexForInnings(currentInnings);
  const playerNames = teamPlayers[battingTeamIndex];

  const strikerName = playerNames[striker] || `Batsman ${striker+1}`;
  const nonStrikerName = playerNames[nonStriker] || `Batsman ${nonStriker+1}`;

  document.getElementById('matchTitle').innerText = `${teamNames[battingTeamIndex]} Batting (Innings ${currentInnings+1}) - Day ${dayNumber}`;
  document.getElementById('batsmenStatus').innerText =
    `On Strike: ${strikerName} (${batsmenStats[currentInnings][striker]?.runs||0} - ${batsmenStats[currentInnings][striker]?.balls||0}) | Non-striker: ${nonStrikerName} (${batsmenStats[currentInnings][nonStriker]?.runs||0} - ${batsmenStats[currentInnings][nonStriker]?.balls||0})`;

  let info = `Over: ${oversCompleted}.${ballsInOver} | Wkts: ${wickets[currentInnings]} | Runs: ${scores[currentInnings]}`;
  if(targets[currentInnings]){
    const rem = targets[currentInnings] - scores[currentInnings];
    info += ` | Target: ${targets[currentInnings]} | To Win: ${rem}`;
  }
  info += ` | DayBalls: ${dayBallsCount}/${dayBallsLimit}`;
  document.getElementById('overInfo').innerText = info;

  document.getElementById('ballLog').innerText = `Ball-by-Ball: ${ballByBall[currentInnings].join(", ")}`;

  let statsHTML = `<strong>Bowler Stats</strong><br/>`;
  if(currentBowler !== null){
    const bowlingTeamIdx = 1 - battingTeamIndex;
    const b = bowlerStats[bowlingTeamIdx][currentBowler];
    const oversB = `${Math.floor(b.balls/6)}.${b.balls%6}`;
    statsHTML += `${b.name}: ${oversB} ov, ${b.runs}r, ${b.wickets}w`;
  } else {
    statsHTML += `No bowler selected.`;
  }
  document.getElementById('bowlerStats').innerHTML = statsHTML;
}

/* ========= Bowler selection ========= */
function updateBowlerOptions(){
  const sel = document.getElementById('bowlerSelect');
  sel.innerHTML = '';
  const bowlTeam = 1 - getBattingTeamIndexForInnings(currentInnings);
  bowlerStats[bowlTeam].forEach((b, idx) => {
    const opt = document.createElement('option');
    opt.value = idx; opt.text = b.name;
    sel.appendChild(opt);
  });
  currentBowler = null;
  togglePlayButtons(false);
}

function setBowler(){
  const sel = parseInt(document.getElementById('bowlerSelect').value);
  if(sel === lastBowler){
    alert('Same bowler cannot bowl consecutive overs.');
    document.getElementById('bowlerSelect').value = '';
    currentBowler = null; togglePlayButtons(false); return;
  }
  currentBowler = sel; togglePlayButtons(true); updateUI();
}

function togglePlayButtons(enable){
  document.querySelectorAll('.number-buttons button').forEach(b => b.disabled = !enable);
}

/* ========= Opponent run logic ========= */
function getSmartOpponentRun(){
  if(Math.random() < 0.3) return 0;
  return Math.floor(Math.random()*6)+1;
}

/* ========= Play ball ========= */
function playBall(run){
  if(currentBowler === null) { alert('Please select a bowler.'); return; }

  const battingTeamIndex = getBattingTeamIndexForInnings(currentInnings);
  const bowlingTeamIndex = 1 - battingTeamIndex;
  const strikerStats = batsmenStats[currentInnings][striker];
  const bowler = bowlerStats[bowlingTeamIndex][currentBowler];

  let batsRun = 0;
  let out = false;

  if(battingTeamIndex === userTeamIndex){
    // User batting
    const compRun = getSmartOpponentRun();
    batsRun = run;
    out = (run === compRun);
  } else {
    // Computer batting
    const compRun = getSmartOpponentRun();
    batsRun = compRun;
    out = (run === compRun);
  }

  ballsBowled[currentInnings]++; bowler.balls++;
  dayBallsCount++;

  if(out){
    log(`${teamPlayers[battingTeamIndex][striker]} is OUT!`);
    strikerStats.balls++;
    wickets[currentInnings]++;
    bowler.wickets++;
    striker = wickets[currentInnings] + 1;
  } else {
    strikerStats.runs += batsRun;
    strikerStats.balls++;
    scores[currentInnings] += batsRun;
    bowler.runs += batsRun;
    if(batsRun === 1 || batsRun === 3) [striker, nonStriker] = [nonStriker, striker];
  }

  ballByBall[currentInnings].push(out ? 'W' : batsRun);

  if(ballsBowled[currentInnings] % ballsPerOver === 0){
    [striker, nonStriker] = [nonStriker, striker];
    lastBowler = currentBowler;
    currentBowler = null;
    updateBowlerOptions();
    log('End of over. Select next bowler.');
  }

  updateUI();

  if(wickets[currentInnings] >= 10 || ballsBowled[currentInnings] >= totalBallsPerInnings){
    endInnings();
  }
}

/* ========= End Innings & Result ========= */
function endInnings(){
  const battingTeamIndex = getBattingTeamIndexForInnings(currentInnings);
  log(`${teamNames[battingTeamIndex]} innings over: ${scores[currentInnings]}/${wickets[currentInnings]}`);

  if(currentInnings === 0){
    targets[1] = scores[0] + 1;
    currentInnings = 1; striker = 0; nonStriker = 1;
    log(`${teamNames[getBattingTeamIndexForInnings(1)]} need ${targets[1]} to win.`);
    updateBowlerOptions(); updateUI();
  } else {
    if(scores[1] === scores[0]) finishMatch('Match TIED 🤝','tie');
    else if(scores[1] < scores[0]) finishMatch(`${teamNames[getBattingTeamIndexForInnings(0)]} WIN by ${scores[0] - scores[1]} runs`,'win');
    else finishMatch(`${teamNames[getBattingTeamIndexForInnings(1)]} WIN by ${10 - wickets[1]} wickets`,'win');
  }
}

/* ========= Show Scorecard ========= */
function showScorecard(){
  const scoreDiv = document.getElementById('log');
  scoreDiv.innerHTML += `<hr><h3>Final Scorecard</h3>`;
  
  for(let t=0; t<2; t++){
    scoreDiv.innerHTML += `<h4>${teamNames[t]}: ${scores[t]}/${wickets[t]}</h4>`;
    
    // Batsmen
    let batsHTML = '<strong>Batsmen:</strong><br>';
    const battingInnings = (t === 0) ? 0 : 1;
    teamPlayers[t].forEach((b, idx) => {
      const stats = batsmenStats[battingInnings][idx];
      if(stats) batsHTML += `${b}: ${stats.runs}(${stats.balls})<br>`;
    });
    scoreDiv.innerHTML += batsHTML;
    
    // Bowlers
    let bowlHTML = '<strong>Bowlers:</strong><br>';
    bowlerStats[t].forEach(b => {
      const overs = Math.floor(b.balls/6) + '.' + (b.balls%6);
      bowlHTML += `${b.name}: ${overs} ov, ${b.runs}r, ${b.wickets}w<br>`;
    });
    scoreDiv.innerHTML += bowlHTML;
  }
}

/* ========= Finish Match ========= */
function finishMatch(message, cls){
  log(message);
  togglePlayButtons(false);
  const box = document.getElementById('resultBox');
  box.innerText = message; box.className = ''; box.style.display = 'block';
  if(cls) box.classList.add(cls);

  // Show final scorecard
  showScorecard();
}
</script>
</body>
</html>
