<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdnjs.cloudflare.com https://www.gstatic.com https://www.googleapis.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://firestore.googleapis.com; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://www.gstatic.com https://apis.google.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self' https:; frame-src 'self' https://accounts.google.com https://apis.google.com https://*.firebaseapp.com;">
  <title>Hand Cricket - Tournament Edition</title>
  
  <!-- External Libraries -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
  
  <!-- Your Styles -->
  <link rel="stylesheet" href="cssHC.css">
</head>
<body>

<!-- Fixed Global Buttons -->
<button id="globalHomeBtn" onclick="returnToHome()">ğŸ  Home</button>
<button id="musicToggleBtn" onclick="toggleMusic()" title="Toggle Background Music">
  ğŸµ Music<span class="music-bars paused" id="musicBars"><span></span><span></span><span></span><span></span><span></span></span>
</button>
<button id="globalHistoryBtn" onclick="getMatchHistory()">ğŸ“Š History</button>

<!-- Toss Overlay -->
<div id="tossOverlay">
  <div id="tossBox">
    <span id="tossIcon">ğŸª™</span>
    <div id="tossTitle">Toss Time!</div>
    <div id="tossMsg"></div>
    <div id="tossSubMsg"></div>
    <div class="toss-choice-row" id="tossChoiceRow"></div>
  </div>
</div>

<!-- History Modal -->
<div class="hmodal-bg" id="historyModal">
  <div class="hmodal-box">
    <button class="hmodal-close" onclick="closeHistoryModal()">âœ• Close</button>
    <h2 style="color:#667eea;margin-bottom:20px">ğŸ“Š Match &amp; Tournament History</h2>
    <div style="margin-bottom:20px;display:flex;flex-wrap:wrap;gap:8px">
      <button class="htab-btn active" id="htab-all" onclick="showHistoryTab('all')">ğŸ All Matches</button>
      <button class="htab-btn" id="htab-tournaments" onclick="showHistoryTab('tournaments')">ğŸ† Tournaments</button>
      <button class="htab-btn" id="htab-stats" onclick="showHistoryTab('stats')">ğŸ“ˆ Career Stats</button>
      <button class="htab-btn" id="htab-leaderboard" onclick="showHistoryTab('leaderboard')">ğŸ¥‡ Leaderboard</button>
      <button class="htab-btn" onclick="clearAllHistoryData()" style="background:#ef4444">ğŸ—‘ Clear All</button>
    </div>
    <div id="historyTabContent"></div>
  </div>
</div>

<!-- Resume Tournament Modal -->
<div class="rmodal-bg" id="resumeModal">
  <div class="rmodal-box">
    <h2 style="color:#667eea;margin-bottom:10px">â–¶ï¸ Resume Tournament</h2>
    <p style="color:#718096;margin-bottom:20px">Select a saved tournament to continue:</p>
    <div id="resumeList"></div>
    <button onclick="closeResumeModal()" style="margin-top:20px;background:#718096">Cancel</button>
  </div>
</div>

<!-- Ranked Multiplayer Modal -->
<div class="rmodal-bg" id="rankedModal">
  <div class="rmodal-box">
    <h2 style="color:#667eea;margin-bottom:10px">Ranked Multiplayer</h2>
        <p style="color:#718096;margin-bottom:12px">Entry cost: <strong>1 Match Token</strong></p>
    <div style="margin-bottom:12px;text-align:left">
      <label for="rankedOversSelect" style="display:block;color:#4a5568;font-size:13px;margin-bottom:6px">Select Overs</label>
      <select id="rankedOversSelect" style="max-width:220px">
        <option value="2">2 Overs</option>
        <option value="4" selected>4 Overs</option>
        <option value="6">6 Overs</option>
        <option value="8">8 Overs</option>
        <option value="10">10 Overs</option>
      </select>
    </div>
    <p id="rankedStatus" style="color:#4a5568;margin-bottom:20px">Press "Find Match" to start matchmaking.</p>
    <button id="rankedReadyBtn" onclick="rankedMarkReady()" style="width:auto;background:#48bb78;display:none;margin-bottom:12px">Ready</button>
    <div id="rankedLivePanel" style="display:none;margin-bottom:14px;padding:12px;border-radius:10px;background:#f7fafc;text-align:left">
      <div id="rankedScoreboard" style="font-weight:700;color:#2d3748;margin-bottom:8px">Scoreboard</div>
      <div id="rankedTurnInfo" style="color:#4a5568;font-size:14px">Waiting for room to start...</div>
    </div>
    <div id="rankedNumberRow" class="number-buttons" style="display:none;margin:10px 0 16px 0">
      <button onclick="rankedPlayNumber(0)">0</button>
      <button onclick="rankedPlayNumber(1)">1</button>
      <button onclick="rankedPlayNumber(2)">2</button>
      <button onclick="rankedPlayNumber(3)">3</button>
      <button onclick="rankedPlayNumber(4)">4</button>
      <button onclick="rankedPlayNumber(5)">5</button>
      <button onclick="rankedPlayNumber(6)">6</button>
    </div>
    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
      <button id="rankedFindBtn" onclick="startRankedQueue()" style="width:auto;background:linear-gradient(135deg,#667eea,#764ba2)">Find Match</button>
      <button id="rankedCancelBtn" onclick="cancelRankedQueue()" style="width:auto;background:#f59e0b;display:none">Cancel Queue</button>
      <button id="rankedCloseBtn" onclick="closeRankedModal()" style="width:auto;background:#718096">Close</button>
    </div>
  </div>
</div>

<!-- App Dialog Modal -->
<div class="rmodal-bg" id="appDialogModal">
  <div class="rmodal-box app-dialog-box">
    <h3 id="appDialogTitle" style="color:#2d3748;margin-bottom:10px">Notice</h3>
    <p id="appDialogMessage" style="color:#4a5568;margin-bottom:18px;line-height:1.6"></p>
    <div id="appDialogButtons" style="display:flex;gap:10px;justify-content:flex-end"></div>
  </div>
</div>
<div class="container">
  <!-- Welcome Section -->
  <div class="section" id="welcome-section" style="text-align:center;max-width:900px;margin:0 auto">
    <h1 style="font-size:3em;margin:30px 0;color:#667eea">ğŸ Hand Cricket</h1>
    <p style="font-size:1.3em;color:#666;margin-bottom:40px">The Ultimate Cricket Tournament Simulator</p>
    
    <div id="playerProfilePanel" style="display:none;background:white;padding:18px;border-radius:14px;margin:0 auto 24px auto;max-width:900px;box-shadow:0 6px 18px rgba(0,0,0,.1)">
      <h3 style="color:#2d3748;margin-bottom:12px">Player Progress</h3>
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px">
        <div style="background:#f7fafc;padding:12px;border-radius:10px">
          <div style="color:#718096;font-size:12px">Aura</div>
          <div id="playerAuraValue" style="font-size:26px;font-weight:800;color:#2d3748">0</div>
        </div>
        <div style="background:#f7fafc;padding:12px;border-radius:10px">
          <div style="color:#718096;font-size:12px">Rank Points (RP)</div>
          <div id="playerRPValue" style="font-size:26px;font-weight:800;color:#2d3748">0</div>
        </div>
        <div style="background:#f7fafc;padding:12px;border-radius:10px">
          <div style="color:#718096;font-size:12px">Rank Tier</div>
          <div id="playerTierValue" style="font-size:26px;font-weight:800;color:#2d3748">Bronze</div>
        </div>
        <div style="background:#f7fafc;padding:12px;border-radius:10px">
          <div style="color:#718096;font-size:12px">Match Tokens</div>
          <div id="playerTokensValue" style="font-size:26px;font-weight:800;color:#2d3748">5</div>
        </div>
      </div>
      <p style="color:#718096;font-size:12px;margin-top:10px">Multiplayer (next phase) will consume tokens per ranked match.</p>
    </div>
    
    <div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:40px;border-radius:20px;margin:30px 0">
      <h2 style="color:white;margin-bottom:20px">ğŸ® Welcome to Hand Cricket!</h2>
      <p style="font-size:1.1em;line-height:1.8">Experience the thrill of international cricket tournaments. Choose your team, compete in multiple formats, and lead your nation to glory!</p>
    </div>
    
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:30px 0;text-align:left">
      <div style="background:#f7fafc;padding:25px;border-radius:15px;border-left:5px solid #48bb78">
        <h3 style="color:#48bb78;margin-bottom:15px">ğŸ“‹ How to Play</h3>
        <ul style="line-height:2;color:#4a5568">
          <li>Choose a number (0-6) to bat</li>
          <li>If you match AI's number = OUT!</li>
          <li>Otherwise, score that many runs</li>
          <li>Select bowlers strategically</li>
          <li>Win matches to advance</li>
        </ul>
      </div>
      <div style="background:#f7fafc;padding:25px;border-radius:15px;border-left:5px solid #f59e0b">
        <h3 style="color:#f59e0b;margin-bottom:15px">ğŸ† Tournament Formats</h3>
        <ul style="line-height:2;color:#4a5568">
          <li><strong>ODI World Cup:</strong> 10 overs</li>
          <li><strong>T20 World Cup:</strong> 4 overs</li>
          <li><strong>WTC:</strong> Test matches</li>
          <li><strong>IPL:</strong> 5 overs franchise</li>
        </ul>
      </div>
    </div>
    
    <div id="historySection" style="background:#edf2f7;padding:30px;border-radius:15px;margin:30px 0">
      <h3 style="color:#2d3748;margin-bottom:20px">ğŸ… Your Tournament History</h3>
      <div id="historyContent"><p style="font-style:italic;color:#718096">No tournaments won yet. Start playing!</p></div>
    </div>
    
    <div id="authSection" style="background:white;padding:30px;border-radius:15px;margin:30px 0;box-shadow:0 4px 12px rgba(0,0,0,0.1)">
      <div id="signedOutView">
        <h3 style="color:#2d3748;margin-bottom:15px">â˜ï¸ Save Your Progress</h3>
        <p style="color:#718096;margin-bottom:20px">Sign in with Google to save tournament progress to the cloud and join the global leaderboard!</p>
        <button onclick="signInWithGoogle()" style="background:white;color:#444;padding:12px 30px;border:2px solid #ddd;border-radius:5px;cursor:pointer;font-size:16px;display:inline-flex;align-items:center;gap:10px;box-shadow:0 2px 4px rgba(0,0,0,0.1);width:auto;text-transform:none">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" height="20" alt="G">Sign in with Google
        </button>
      </div>
      <div id="signedInView" style="display:none">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:15px">
          <div style="display:flex;align-items:center;gap:15px">
            <img id="userPhoto" src="" alt="User" style="width:50px;height:50px;border-radius:50%;border:2px solid #667eea">
            <div style="text-align:left">
              <p style="color:#2d3748;font-weight:bold;margin:0" id="userName">User Name</p>
              <p style="color:#718096;font-size:14px;margin:5px 0 0 0" id="userEmail">email</p>
            </div>
          </div>
          <div style="display:flex;gap:10px">
            <button onclick="saveProgressToCloud()" style="padding:10px 20px;background:#48bb78;color:white;border:none;border-radius:5px;cursor:pointer;width:auto">ğŸ’¾ Save</button>
            <button onclick="signOutUser()" style="padding:10px 20px;background:#718096;color:white;border:none;border-radius:5px;cursor:pointer;width:auto">Sign Out</button>
          </div>
        </div>
        <p id="lastSyncTime" style="color:#a0aec0;font-size:14px;margin-top:15px"></p>
      </div>
    </div>
    
    <button onclick="startHandCricket()" style="padding:20px 60px;font-size:1.5em;border-radius:50px;margin:20px 0;box-shadow:0 10px 30px rgba(102,126,234,0.4)">ğŸ® Try Hand Cricket</button>
    <br>
    <button id="rankedModeBtn" onclick="openRankedModal()" style="display:inline-block;background:linear-gradient(135deg,#f59e0b,#d97706);padding:15px 40px;font-size:1.2em;border-radius:50px;margin:10px 0;box-shadow:0 6px 20px rgba(245,158,11,0.4)">Ranked Multiplayer</button>
    <br>
    <button id="resumeTournamentBtn" onclick="openResumeModal()" style="display:none;background:linear-gradient(135deg,#48bb78,#38a169);padding:15px 40px;font-size:1.2em;border-radius:50px;margin:10px 0 30px 0;box-shadow:0 6px 20px rgba(72,187,120,0.4)">â–¶ï¸ Resume Tournament</button>
    <p style="color:#a0aec0;margin-top:30px">Made with â¤ï¸ for Cricket Fans | Version 3.5</p>
  </div>

  <h1 style="display:none" id="main-title">ğŸ Hand Cricket - Tournament Edition</h1>
  
  <!-- Celebration Overlays -->
  <div id="celebrationOverlay"><span id="celebrationText"></span></div>
  <div id="trophyAnimation" class="trophy-animation">
    <div class="trophy">ğŸ†</div>
    <h1 style="color:white;margin-top:20px" id="trophyText">CHAMPION!</h1>
    <button onclick="closeTrophy()" style="margin-top:30px;padding:15px 40px">Continue</button>
  </div>

  <!-- Setup Section -->
  <div class="section" id="setup-section" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
      <h2>âš™ï¸ Setup Match</h2>
      <button onclick="returnToHome()" style="width:auto;padding:8px 18px;background:#718096;font-size:13px">ğŸ  Home</button>
    </div>
    
    <h3>Select Mode</h3>
    <select id="matchMode" onchange="handleModeChange()">
      <option value="custom">Custom Match</option>
      <option value="t20i">T20I (4 overs)</option>
      <option value="odi">ODI (10 overs)</option>
      <option value="test">Test (25 overs/day, 5 days)</option>
      <option value="rct">RCT (15 overs)</option>
      <option value="ipl">IPL (5 overs)</option>
      <option value="tournament">ğŸ† Tournament Mode</option>
    </select>
    
    <div id="customMatchSetup">
      <h3>Predefined Teams</h3>
      <select id="predefinedTeams" onchange="handleTeamSelection()">
        <option value="">--Select Team--</option>
      </select>
      <h3>Team Names</h3>
      <div class="team-inputs" style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px">
        <input id="team1" placeholder="Your Team Name" maxlength="50"/>
        <input id="team2" placeholder="Computer Team Name" value="Computer" maxlength="50"/>
      </div>
      <label for="overs">Number of Overs</label>
      <input id="overs" type="number" min="1" max="50" value="2"/>
      <h3>Players (comma-separated)</h3>
      <textarea id="team1Players" rows="3" placeholder="Your players" maxlength="2000"></textarea>
      <textarea id="team2Players" rows="3" placeholder="Computer players" maxlength="2000"></textarea>
      <button onclick="startGame()">ğŸ® Start Match</button>
    </div>
    
    <div id="tournamentSetup" style="display:none">
      <h3>ğŸ† Select Tournament Format</h3>
      <select id="tournamentFormat" onchange="handleTournamentFormatChange()" style="margin:15px 0">
        <option value="">--Select Format--</option>
        <option value="odiWorldCup">ODI World Cup (10 overs)</option>
        <option value="t20WorldCup">T20 World Cup (4 overs)</option>
        <option value="wtc">WTC - World Test Championship (25 overs)</option>
        <option value="ipl">IPL (5 overs)</option>
      </select>
      <div id="tournamentFormatDetails" style="display:none">
        <p id="formatDescription" style="margin:15px 0;color:#666"></p>
        <h4>Your Team</h4>
        <select id="userTournamentTeam"><option value="">--Select Your Team--</option></select>
        <button onclick="startTournament()">ğŸš€ Start Tournament</button>
      </div>
    </div>
  </div>

  <!-- Tournament Section -->
  <div class="section" id="tournament-section" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:15px">
      <h2 id="tournamentTitle">ğŸ† ODI World Cup</h2>
      <button onclick="returnToHome()" style="width:auto;padding:8px 18px;background:#718096;font-size:13px">ğŸ  Home</button>
    </div>
    <div class="tournament-nav" id="tournamentNav">
      <button onclick="showTournamentStage('challengeLeague')">Challenge League</button>
      <button onclick="showTournamentStage('super6')">Super 6</button>
      <button onclick="showTournamentStage('qualifier')">Qualifier</button>
      <button onclick="showTournamentStage('worldCup')">World Cup</button>
      <button onclick="showStatsCorner()" style="background:#f59e0b">ğŸ“Š Stats</button>
    </div>
    <div id="statsCornerBtn" style="display:none;margin:10px 0">
      <button onclick="showStatsCorner()" style="width:100%;padding:12px;background:#f59e0b">ğŸ“Š Stats Corner</button>
    </div>
    <div id="tournamentContent"></div>
  </div>

  <!-- Game Section -->
  <div class="section" id="game-section" style="display:none">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:10px">
      <h2 id="matchTitle">Match</h2>
      <div style="display:flex;gap:8px">
        <button id="pauseMatchBtn" style="display:none;background:#f59e0b;width:auto;padding:8px 16px;font-size:13px" onclick="pauseMatch()">â¸ï¸ Pause</button>
        <button onclick="returnToHome()" style="width:auto;padding:8px 16px;background:#718096;font-size:13px">ğŸ  Home</button>
      </div>
    </div>
    
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-label">Score</div><div class="stat-value" id="scoreDisplay">0/0</div></div>
      <div class="stat-card"><div class="stat-label">Overs</div><div class="stat-value" id="oversDisplay">0.0</div></div>
      <div class="stat-card"><div class="stat-label">Target</div><div class="stat-value" id="targetDisplay">-</div></div>
    </div>
    
    <h3 id="batsmenStatus"></h3>
    <div id="dayOversDisplay">Day 1 | Over 0.0</div>
    
    <label for="bowlerSelect">Select Bowler:</label>
    <select id="bowlerSelect" onchange="handleBowlerSelection()"></select>
    
    <div class="number-buttons">
      <button onclick="playBall(0)">0</button>
      <button onclick="playBall(1)">1</button>
      <button onclick="playBall(2)">2</button>
      <button onclick="playBall(3)">3</button>
      <button onclick="playBall(4)">4</button>
      <button onclick="playBall(5)">5</button>
      <button onclick="playBall(6)">6</button>
    </div>
    
    <button id="continueDayBtn" style="display:none" onclick="continueNextDay()">â–¶ï¸ Continue Next Day</button>
    <button id="declareBtn" style="display:none;background:linear-gradient(135deg,#e53e3e,#c53030);color:white;border:none;padding:10px 28px;border-radius:50px;font-weight:700;font-size:14px;cursor:pointer;margin:6px 4px;box-shadow:0 4px 12px rgba(229,62,62,.4)" onclick="declareBattingInnings()">ğŸ³ï¸ Declare</button>
    
    <div id="ballLog"></div>
    <div id="bowlerStats"></div>
    <div id="log"></div>
    <div id="resultBox"></div>
  </div>
</div>

<!-- Your JavaScript Files (Load in order) -->
<script src="core engine.js"></script>
<script src="Game-state.js"></script>
<script src="tournament.js"></script>
<script src="Debug.js"></script>
</body>
</html>



